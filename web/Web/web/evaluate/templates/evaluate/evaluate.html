{% extends "base.html" %}
{% load static %}
{% block pagetitle %}Evaluate{% endblock %}
{% block extra_head %}<link href="{% static 'css/metricsgraphics.css' %}" rel="stylesheet">{% endblock %}


{% block main %}


<div class="mb-4">

    <div class="row">
        <div class="col-12 col-md-10 mt-5">

          <h3 class="pl-4 text-center">User reported and found relevant documents</h3>
          <div class="d-flex flex-row justify-content-around mt-3">
            <div class="result result1 center-text" id="result1" >
              <div class="mx-auto resultSpinner mt-5">
                <div class="la-ball-circus text-secondary">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
              </div>
            </div>
            <div class="result result2 center-text" id="result2" >
              <div class="mx-auto resultSpinner mt-5">
                <div class="la-ball-circus text-secondary">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="col-2 d-none d-sm-block">
            <div class="sticky-top card border-0 mr-2" style="top:75px; z-index: 0;">
                <div class="card-body p-0 mt-3">
                    <nav class="nav nav-pills small flex-row flex-sm-row unselectable" unselectable="on">
                        <a class="flex-sm-fill text-sm-center nav-link active">Qrels Information</a>
                    </nav>

                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="reviewed-documents-tab" role="tabpanel">
                            <div class="mt-3" id="latest_judged">
                                <div class="card border-0">
                                    <div class="card-body px-0 py-2 d-flex"
                                        style="min-height: 18rem; max-height: 38rem;">
                                        <!-- loader -->
                                        <div class="mx-auto previouslyReviewedListSpinner mt-5">
                                            <div class="la-ball-circus text-secondary">
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                            </div>
                                        </div>
                                        <!-- end loader -->
                                        <div id="previouslyReviewedList"
                                            class="overflow-auto small previouslyReviewedList" style="min-width: 0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>



{% endblock %}



{% block extra_scripts %}
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/3.0-alpha3/metricsgraphics.min.js"></script>

  <script>

  d3.json('{% url 'evaluate:data:user_reported_and_found_relevant_documents' %}', function(data) {

    if (data["error"] !== undefined){
      $(".resultSpinner").remove();
      // DATA COULDN'T BE RETRIEVED
      $(".result").each(function () {
        MG.data_graphic({
            title: "Error",
            error: 'The data could not be retrieved.',
            chart_type: 'missing-data',
            missing_text: 'The data could not be retrieved.',
            target: "#"+$(this).attr("id"),
            color: '#F7533D',
            width: 400,
            height: 350
        });
      })

    } else {
      // DATA RETRIEVED
      const targets = [{"target": ".result1", "x_accessor": "x_percent", "y_accessor": "y_percent", "title": "percentage"},
                       {"target": ".result2", "x_accessor": "x", "y_accessor": "y", "title": "numerical"}];
      $(".resultSpinner").remove();
      targets.forEach(function (entry) {
        MG.data_graphic({
          title: entry["title"],
          data: data,
          width: 400,
          height: 350,
          target: entry["target"],
          interpolate: d3.curveLinear,
          color: '#F7533D',
          x_accessor: entry["x_accessor"],
          y_accessor: entry["y_accessor"],
          x_label: "# User reported relevant documents",
          y_label: "# User Found Qrel's Relevant documents",
          brush: 'xy',
        });
      });

    }

  });


  </script>
{% endblock %}
